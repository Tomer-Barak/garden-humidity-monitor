<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Garden</title>
    
    <!-- PWA Meta Tags -->
    <meta name="application-name" content="Garden">
    <meta name="apple-mobile-web-app-title" content="Garden">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#2ecc71">
    
    <!-- Icons for homescreen -->
    <link rel="icon" type="image/png" sizes="192x192" href="{{ url_for('static', filename='icons/garden-192.png') }}">
    <link rel="icon" type="image/png" sizes="512x512" href="{{ url_for('static', filename='icons/garden-512.png') }}">
    <link rel="apple-touch-icon" sizes="180x180" href="{{ url_for('static', filename='icons/garden-180.png') }}">
    <link rel="shortcut icon" href="{{ url_for('static', filename='icons/garden-32.png') }}">
    
    <!-- Web App Manifest -->
    <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
    
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸŒ± Garden Humidity Dashboard</h1>
            <div class="status-indicator" id="status"></div>
        </header>

        <div class="controls">
            <select id="deviceSelect">
                <option value="">All Devices</option>
            </select>
            <select id="sensorSelect">
                <option value="">All Sensors</option>
            </select>
            <button id="editSensorNamesBtn" title="Sensor Configuration">âš™ï¸ Settings</button>
            <select id="timeRange">
                <option value="1">Last Hour</option>
                <option value="6">Last 6 Hours</option>
                <option value="24" selected>Last 24 Hours</option>
                <option value="168">Last Week</option>
            </select>
            <button id="refreshBtn">Refresh</button>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <h3>Current Humidity</h3>
                <div class="stat-value" id="currentHumidity">--</div>
                <div class="stat-unit">%</div>
            </div>
            <div class="stat-card">
                <h3>Average (24h)</h3>
                <div class="stat-value" id="avgHumidity">--</div>
                <div class="stat-unit">%</div>
            </div>
            <div class="stat-card">
                <h3>Min/Max (24h)</h3>
                <div class="stat-value" id="minMaxHumidity">--</div>
                <div class="stat-unit">%</div>
            </div>
            <div class="stat-card">
                <h3>Total Readings</h3>
                <div class="stat-value" id="totalReadings">--</div>
                <div class="stat-unit">readings</div>
            </div>
        </div>

        <div class="chart-container">
            <canvas id="humidityChart"></canvas>
        </div>

        <div class="memories-card">
            <h3>ğŸ“ Garden Memories</h3>
            <div class="latest-memory" id="latestMemory">
                <div class="memory-placeholder">No memories yet. Share your first garden observation!</div>
            </div>
            <div class="memory-actions">
                <button id="writeMemoryBtn" class="btn-memory">âœï¸ Write Memory</button>
                <button id="viewAllMemoriesBtn" class="btn-memory-secondary">ğŸ“– View All</button>
            </div>
        </div>

        <div class="recent-readings">
            <h3>Recent Readings</h3>
            <div class="table-container">
                <table id="readingsTable">
                    <thead>
                        <tr>
                            <th>Time</th>
                            <th>Sensor</th>
                            <th>Humidity</th>
                            <th>Raw Value</th>
                            <th>Device</th>
                            <th>Alerts</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Sensor Names Edit Modal -->
    <div id="sensorNamesModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Sensor Configuration</h2>
                <span class="close-modal">&times;</span>
            </div>
            <div class="modal-body">
                <p>Customize how your sensors are displayed, set humidity thresholds for alerts, and manage alert settings. Settings are stored on the server and persist across restarts.</p>
                <div id="sensorNamesList">
                    <!-- Sensor configuration inputs will be populated here -->
                </div>
            </div>
            <div class="modal-footer">
                <button id="saveSensorNames" class="btn-primary">Save Changes</button>
                <button id="resetSensorNames" class="btn-secondary">Reset to Default</button>
                <button id="cancelSensorNames" class="btn-secondary">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Memory Writing Modal -->
    <div id="memoryModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>âœï¸ Write Garden Memory</h2>
                <span class="close-modal" id="closeMemoryModal">&times;</span>
            </div>
            <div class="modal-body">
                <p>Share your observations, discoveries, or notes about your garden. These memories help track patterns and learnings over time.</p>
                <form id="memoryForm">
                    <div class="form-group">
                        <label for="userNameInput">Your Name:</label>
                        <input type="text" id="userNameInput" placeholder="Enter your name..." required>
                        <small>Your name will be saved for future entries</small>
                    </div>
                    <div class="form-group">
                        <label for="memoryTextInput">Memory:</label>
                        <div class="memory-input-controls">
                            <button type="button" id="rtlToggle" class="rtl-toggle" title="Toggle Hebrew/RTL text direction">
                                <span id="rtlToggleText">×â†’ Hebrew</span>
                            </button>
                        </div>
                        <textarea id="memoryTextInput" placeholder="Share your garden observation, discovery, or note..." rows="6" maxlength="1000" required></textarea>
                        <div class="char-counter">
                            <span id="charCount">0</span>/1000 characters
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="photoInput">Add Photo (Optional):</label>
                        <div class="photo-input-controls">
                            <input type="file" id="photoInput" accept="image/*" style="display: none;">
                            <div class="photo-buttons">
                                <button type="button" id="selectPhotoBtn" class="btn-photo">ğŸ–¼ï¸ Select Photo</button>
                                <button type="button" id="removePhotoBtn" class="btn-photo btn-remove" style="display: none;">ğŸ—‘ï¸ Remove</button>
                            </div>
                        </div>
                        <div id="photoPreview" class="photo-preview" style="display: none;">
                            <img id="previewImage" src="" alt="Preview">
                            <div class="photo-info">
                                <span id="photoName"></span>
                                <span id="photoSize"></span>
                            </div>
                        </div>
                        
                        <!-- Photo Rotation Controls -->
                        <div id="photoRotationControls" class="photo-rotation-controls" style="display: none;">
                            <label>Rotate Photo:</label>
                            <div class="rotation-controls">
                                <button type="button" id="rotateLeftBtn" class="btn-rotate" title="Rotate 90Â° counter-clockwise">
                                    â†º Left
                                </button>
                                <button type="button" id="rotateRightBtn" class="btn-rotate" title="Rotate 90Â° clockwise">
                                    â†» Right
                                </button>
                                <button type="button" id="resetRotationBtn" class="btn-rotate btn-reset" title="Reset to original orientation">
                                    âŸ² Reset
                                </button>
                                <span id="rotationDisplay" class="rotation-display">0Â°</span>
                            </div>
                            <small>The preview above shows how your photo will appear after upload.</small>
                        </div>
                        
                        <video id="cameraPreview" class="camera-preview" style="display: none;" autoplay playsinline></video>
                        <canvas id="photoCanvas" style="display: none;"></canvas>
                        <small>Supported formats: PNG, JPG, JPEG, GIF, WEBP. Max size: 10MB</small>
                    </div>
                    
                    <div class="form-group">
                        <div class="emoji-picker">
                            <div class="emoji-collection">
                                <span class="emoji" data-emoji="ğŸŒ±">ğŸŒ±</span>
                                <span class="emoji" data-emoji="ğŸŒ¿">ğŸŒ¿</span>
                                <span class="emoji" data-emoji="ğŸŒ¾">ğŸŒ¾</span>
                                <span class="emoji" data-emoji="ğŸŒ³">ğŸŒ³</span>
                                <span class="emoji" data-emoji="ğŸŒ²">ğŸŒ²</span>
                                <span class="emoji" data-emoji="ğŸƒ">ğŸƒ</span>
                                <span class="emoji" data-emoji="ğŸŒµ">ğŸŒµ</span>
                                <span class="emoji" data-emoji="ğŸŒ´">ğŸŒ´</span>
                                <span class="emoji" data-emoji="ğŸŒº">ğŸŒº</span>
                                <span class="emoji" data-emoji="ğŸŒ»">ğŸŒ»</span>
                                <span class="emoji" data-emoji="ğŸŒ·">ğŸŒ·</span>
                                <span class="emoji" data-emoji="ğŸŒ¹">ğŸŒ¹</span>
                                <span class="emoji" data-emoji="ğŸŒ¸">ğŸŒ¸</span>
                                <span class="emoji" data-emoji="ğŸ’">ğŸ’</span>
                                <span class="emoji" data-emoji="ğŸµï¸">ğŸµï¸</span>
                                <span class="emoji" data-emoji="ğŸŒ¼">ğŸŒ¼</span>
                                <span class="emoji" data-emoji="ğŸ…">ğŸ…</span>
                                <span class="emoji" data-emoji="ğŸ¥•">ğŸ¥•</span>
                                <span class="emoji" data-emoji="ğŸ¥¬">ğŸ¥¬</span>
                                <span class="emoji" data-emoji="ğŸ¥’">ğŸ¥’</span>
                                <span class="emoji" data-emoji="ğŸŒ¶ï¸">ğŸŒ¶ï¸</span>
                                <span class="emoji" data-emoji="ğŸŒ½">ğŸŒ½</span>
                                <span class="emoji" data-emoji="ğŸ†">ğŸ†</span>
                                <span class="emoji" data-emoji="ğŸ¥”">ğŸ¥”</span>
                                <span class="emoji" data-emoji="ğŸ§„">ğŸ§„</span>
                                <span class="emoji" data-emoji="ğŸ§…">ğŸ§…</span>
                                <span class="emoji" data-emoji="ğŸ“">ğŸ“</span>
                                <span class="emoji" data-emoji="ğŸ‡">ğŸ‡</span>
                                <span class="emoji" data-emoji="â˜€ï¸">â˜€ï¸</span>
                                <span class="emoji" data-emoji="ğŸŒ¤ï¸">ğŸŒ¤ï¸</span>
                                <span class="emoji" data-emoji="â›…">â›…</span>
                                <span class="emoji" data-emoji="ğŸŒ¦ï¸">ğŸŒ¦ï¸</span>
                                <span class="emoji" data-emoji="ğŸŒ§ï¸">ğŸŒ§ï¸</span>
                                <span class="emoji" data-emoji="â˜”">â˜”</span>
                                <span class="emoji" data-emoji="â›ˆï¸">â›ˆï¸</span>
                                <span class="emoji" data-emoji="â„ï¸">â„ï¸</span>
                                <span class="emoji" data-emoji="ğŸŒªï¸">ğŸŒªï¸</span>
                                <span class="emoji" data-emoji="ğŸ’§">ğŸ’§</span>
                                <span class="emoji" data-emoji="ğŸš¿">ğŸš¿</span>
                                <span class="emoji" data-emoji="ğŸ§½">ğŸ§½</span>
                                <span class="emoji" data-emoji="ğŸª£">ğŸª£</span>
                                <span class="emoji" data-emoji="ğŸ§´">ğŸ§´</span>
                                <span class="emoji" data-emoji="ğŸ”§">ğŸ”§</span>
                                <span class="emoji" data-emoji="ğŸ› ï¸">ğŸ› ï¸</span>
                                <span class="emoji" data-emoji="âœ‚ï¸">âœ‚ï¸</span>
                                <span class="emoji" data-emoji="ğŸ›">ğŸ›</span>
                                <span class="emoji" data-emoji="ğŸ">ğŸ</span>
                                <span class="emoji" data-emoji="ğŸ¦‹">ğŸ¦‹</span>
                                <span class="emoji" data-emoji="ğŸ">ğŸ</span>
                                <span class="emoji" data-emoji="ğŸœ">ğŸœ</span>
                                <span class="emoji" data-emoji="ğŸ•·ï¸">ğŸ•·ï¸</span>
                                <span class="emoji" data-emoji="ğŸŒ">ğŸŒ</span>
                                <span class="emoji" data-emoji="ğŸª±">ğŸª±</span>
                                <span class="emoji" data-emoji="ğŸ“Š">ğŸ“Š</span>
                                <span class="emoji" data-emoji="ğŸ“ˆ">ğŸ“ˆ</span>
                                <span class="emoji" data-emoji="ğŸ“‰">ğŸ“‰</span>
                                <span class="emoji" data-emoji="ğŸ“">ğŸ“</span>
                                <span class="emoji" data-emoji="ğŸ”">ğŸ”</span>
                                <span class="emoji" data-emoji="ğŸ“">ğŸ“</span>
                                <span class="emoji" data-emoji="ğŸ“…">ğŸ“…</span>
                                <span class="emoji" data-emoji="ğŸ•’">ğŸ•’</span>
                                <span class="emoji" data-emoji="ğŸ˜Š">ğŸ˜Š</span>
                                <span class="emoji" data-emoji="ğŸ˜„">ğŸ˜„</span>
                                <span class="emoji" data-emoji="ğŸ‰">ğŸ‰</span>
                                <span class="emoji" data-emoji="ğŸ˜°">ğŸ˜°</span>
                                <span class="emoji" data-emoji="ğŸ˜®">ğŸ˜®</span>
                                <span class="emoji" data-emoji="ğŸ¤”">ğŸ¤”</span>
                                <span class="emoji" data-emoji="ğŸ’ª">ğŸ’ª</span>
                                <span class="emoji" data-emoji="ğŸ‘">ğŸ‘</span>
                                <span class="emoji" data-emoji="ğŸ‘">ğŸ‘</span>
                                <span class="emoji" data-emoji="â¤ï¸">â¤ï¸</span>
                                <span class="emoji" data-emoji="ğŸ½ï¸">ğŸ½ï¸</span>
                                <span class="emoji" data-emoji="ğŸ¥—">ğŸ¥—</span>
                                <span class="emoji" data-emoji="ğŸ²">ğŸ²</span>
                                <span class="emoji" data-emoji="ğŸ§º">ğŸ§º</span>
                                <span class="emoji" data-emoji="ğŸƒ">ğŸƒ</span>
                                <span class="emoji" data-emoji="ğŸ¥œ">ğŸ¥œ</span>
                                <span class="emoji" data-emoji="ğŸŒ°">ğŸŒ°</span>
                                <span class="emoji" data-emoji="ğŸ‘¨â€ğŸŒ¾">ğŸ‘¨â€ğŸŒ¾</span>
                                <span class="emoji" data-emoji="ğŸ‘©â€ğŸŒ¾">ğŸ‘©â€ğŸŒ¾</span>
                                <span class="emoji" data-emoji="ğŸ‘¤">ğŸ‘¤</span>
                                <span class="emoji" data-emoji="ğŸ‘¥">ğŸ‘¥</span>
                                <span class="emoji" data-emoji="ğŸ‘¨">ğŸ‘¨</span>
                                <span class="emoji" data-emoji="ğŸ‘©">ğŸ‘©</span>
                                <span class="emoji" data-emoji="ğŸ‘¶">ğŸ‘¶</span>
                                <span class="emoji" data-emoji="ğŸ‘µ">ğŸ‘µ</span>
                                <span class="emoji" data-emoji="ğŸ‘´">ğŸ‘´</span>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button id="saveMemoryBtn" class="btn-primary">ğŸ’¾ Save Memory</button>
                <button id="cancelMemoryBtn" class="btn-secondary">Cancel</button>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
</body>
</html>
